<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <title>dontchat</title>
    <style>
        body {
            height: 90vh;
        }
        .full-screen {
            display: flex;
            height: 100%;
            width: 100%;
        }
        .align-form {
            width: 100%;
            height: 100%;
            display: flex;
            align-self: flex-end;
        }
        .box-chat {
            width: 80%;
            margin-right: 10px;
            word-wrap: break-word;
        }
        .send-chat {
            width: 20%;
        }
        #messages {
            overflow: auto;
            width: 90%;
            margin-left: 5%;
        }
        .organize {
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .text-design {
            background-color: #cccccc;
            font-family: sans-serif;
            padding: 1%;
            border-radius: 10px;
            word-wrap: break-word;
        }
        .box-send_enter {
            width: 100%;
            height: 9.5vh;
        }
    </style>
</head>

<body>
    <h1>Sala de Chat: {{ chatId }}</h1>
    <div class="full-screen">
        <div class="organize">
            <div id="messages"></div>
            <div class="box-send_enter">
                <form class="align-form">
                    <input autoComplete="off" class="box-chat" name="box" type="text" placeholder="Digite a sua mensagem" id="box_message">
                    <button class="send-chat" type="submit">Enviar</button>
                </form>
            </div>
        </div>
    </div>
</body>
<script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js" integrity="sha256-yr4fRk/GU1ehYJPAs8P4JlTgu0Hdsp4ZKrx8bDEDC3I=" crossorigin="anonymous"></script>
<script>
    var socket = io('http://' + document.domain + ':' + location.port);
    socket.on('connect', () => {
        socket.emit('connecting', {data: 'Connected!'});
    });
    socket.on('connecting', (data) => {
        console.log(data)
    });

    let chat = document.querySelector('form');
    let message_box = document.getElementById('box_message');

    chat.addEventListener('submit', (event) => {
        socket.emit('message', {
            username: "{{ username }}",
            chatId: "{{ chatId }}",
            date: new Date,
            message: message_box.value
        })
        event.preventDefault();
        document.getElementById('box_message').value = '';
    });

    socket.on('message', (data) => {
        const text_chat = document.createElement('div');
        console.log(data)
        text_chat.innerHTML = `<p  class="text-design"><b>${data.username}:&nbsp</b><br> ${data.message}</p>`;
        document.getElementById('messages').appendChild(text_chat);
    })
</script>

</html>